# 3-Tree Manager

3-Tree Manager - это консольное приложение на языке Си, предназначенное для построения и обработки дерева общего вида. Программа предоставляет интерактивное текстовое меню для управления структурой данных, позволяя добавлять узлы, удалять поддеревья, визуализировать структуру и вычислять характеристики дерева, такие как его степень.

## Особенности реализации

### Архитектура данных
Дерево реализовано динамически, с использованием двусвязного списка. Это позволяет эффективно хранить деревья произвольной степени ветвления без предварительного выделения массивов.

Структура узла (`Node`) содержит:
*   `value`: целочисленное значение (является уникальным в дереве).
*   `first_child`: указатель на первого потомка.
*   `last_child`: указатель на последнего потомка (для оптимизации добавления в конец за $O(1)$).
*   `next` / `prev`: указатели на соседние узлы (двусвязный список детей) для быстрого удаления из середины списка.
*   `parent`: указатель на родительский узел для навигации вверх.

### Безопасность и надежность
1.  **Защита от Undefined Behavior (UB):** В модуле визуализации (`PrintTree`) реализована защита от переполнения битового сдвига. Программа использует битовую маску `unsigned long long` для отрисовки линий связей. Для деревьев глубиной более 64 уровней программа корректно отключает отрисовку дальних вертикальных линий, предотвращая неопределенное поведение, но сохраняя читаемость структуры.
2.  **Управление памятью:** Все операции выделения памяти проверяются. В случае нехватки памяти программа сообщает об ошибке и корректно прерывает операцию, не допуская аварийного завершения или утечек.
3.  **Валидация ввода:** Реализована очистка буфера ввода для защиты от некорректного ввода (например, зацикливания при вводе букв вместо чисел).

## Технические допущения и ограничения

1.  **Уникальность ключей:**
    *   Значения узлов **обязаны быть уникальными**. Программа не поддерживает добавление дубликатов.
    *   **При удалении:** Удаляется узел вместе с поддеревом.

2.  **Стек вызовов (Recursion):**
    *   Алгоритмы обхода (поиск, удаление, подсчет степени, печать) реализованы в виде поиска в глубину (DFS), где обход по соседям текущего уровня данного поддерева осуществляется итеративно, а обход в глубину рекурсивно.

3.  **Визуализация:**
    *   Используется псевдографика ASCII.
    *   Идеальная отрисовка связей гарантируется до глубины **64 уровня**. Глубже 64-го уровня структура отображается с упрощенными отступами, чтобы избежать ошибок переполнения.

## Структура проекта

*   **`main.c`**: Точка входа, реализация текстового меню и цикла обработки команд.
*   **`tree.h` / `tree.c`**: Низкоуровневая логика работы со структурой данных (создание узлов, связывание родитель-потомок, освобождение памяти).
*   **`tree_service.h` / `tree_service.c`**: Сервисная логика и алгоритмы (поиск по значению, вычисление степени дерева, рекурсивная визуализация).

## Сборка и запуск

Для сборки требуется компилятор `gcc`.

### Шаг 1: Компиляция

```bash
gcc -Wall -Wextra -std=c11 main.c tree.c tree_service.c -o 3tree_manager.bin
```
> **Примечание:** Флаги `-Wall -Wextra` включают вывод подробных предупреждений компилятора, что помогает обнаружить потенциальные проблемы.

### Шаг 2: Запуск

**Linux / macOS:**
```bash
./3tree_manager.bin
```

## Руководство пользователя

После запуска доступно следующее меню:

1.  **Добавить узел**:
    *   Если дерево пустое, программа предложит создать корень.
    *   Если дерево уже существует, запрашивается `Значение родителя` и `Значение нового узла`. Новый узел добавляется в конец списка детей указанного родителя.
2.  **Визуализировать дерево**: Выводит текущую структуру дерева в консоль с отступами и линиями связей.
3.  **Удалить узел (поддерево)**: Запрашивает значение узла. **Внимание:** удаляется найденный узел и **все его потомки** (всё поддерево). Память освобождается корректно.
4.  **Определить степень дерева**: Вычисляет и выводит степень дерева.
0.  **Выход**: Очищает всю выделенную память (удаляет всё дерево) и завершает работу программы.

## Пример работы

```text
----- СТРУКТУРА ДЕРЕВА -----
1
|-- 2
|-- 6
+-- 7
    |-- 3
    |-- 4
    +-- -10
        |-- 5
        +-- 8
----------------------------
```
